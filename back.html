<div id="cloze-is-back" hidden="">{{cloze:Text}}</div>
{{FrontSide}}

<br /><br />

<div class="note-box" hidden="">{{Back Extra}}</div>

<div id="cloze-is-back" hidden="">{{cloze:Text}}</div>
{{FrontSide}}

<br /><br />
<div class="notes-container">
  <div class="note-box" hidden="">{{Back Extra}}</div>
</div>

<script>
  (function applyNotes() {
    const activeCloze = document.querySelector(".cloze");
    const cardOrd = activeCloze.getAttribute("data-ordinal");
    const noteBox = document.querySelector(".note-box");

    const noteBoxContent = noteBox.innerHTML.trim();
    if (noteBoxContent.length == 0) return;

    const notes = noteBoxContent.split("|||");

    for (let i = 0; i < notes.length; i++) {
      note = notes[i].trim().replace(/^[<br>\s]+/, "");
      if (
        (note && !noteBoxContent.match(/C\d+?::/)) ||
        note.match(`^C${cardOrd}::`)
      ) {
        let noteContent = note.replace(`C${cardOrd}::`, "");
        noteContent = noteContent.replace("G::", "");
        noteBox.innerHTML =
          "<span class='note-header'>NOTE</span><p>" + noteContent + "</p>";
        noteBox.hidden = false;
      } else if (note.match("^G::")) {
        const g_noteContent = note.replace(`G::`, "");
        var g_note = document.createElement("div");
        g_note.setAttribute("class", "note-box");
        g_note.innerHTML = `<span class='note-header'>NOTE</span><p>${g_noteContent}</p>`;
        const notes_container = document.querySelector(".notes-container");
        notes_container.appendChild(g_note);
      }
    }
  })();
</script>
